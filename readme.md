# libgfapi-jni

Java Native Interface (JNI) bindings for libgfapi, the GlusterFS client API.

# instructions

## groundwork

### Prerequisites

* gluster 3.4 or newer - installed from source or a gluster development package installed.
* maven 3.0.3 or newer
* auto tool chain

## Compiling without tests

If you have installed gluster to non-standard location then you export `GLFS_HOME` so we know where it's at:

    export GLFS_HOME=/path/to/gluster/prefix

Building without tests is simple.  Just run:

    mvn -Pdownlaod -Plinux64 -Dmaven.test.skip=true install

## Compiling and Testing

To really test this you'll need a running glusterfs volume called *foo*.

- Set up a loopback interface alias, because glusterfs refuses to create a volume with a brick on *localhost* or *127.0.0.1*

        ifconfig lo:0 127.0.2.1

- Create a glusterfs volume called *foo*

        gluster volume create foo 127.0.2.1:/var/tmp/foo
        gluster volume start foo

- Gluster requires that clients communicate from privileged source ports by default, so we need to disable this feature before testing.

        gluster volume set foo server.allow-insecure on

We also need to manually fix glusterd, since it is not affected by the previous volume configuration command.  Edit /etc/glusterfs/glusterd.vol 
and add this line after the other option statements in the volume management stanza

        option rpc-auth-allow-insecure on

Finally, since our clients will not be privileged, we need to make the volume world writable the usual way

        mkdir /mnt/foo
        mount -t glusterfs localhost:foo /mnt/foo
        chmod ugo+rwx /mnt/foo
        umount /mnt/foo
        rmdir /mnt/foo

- Make sure that the gluster libs are on the LD_LIBRARY_PATH.

        export LD_LIBRARY_PATH=${GLUSTER_PREFIX}/lib

- Now run the test

        mvn -Pdownload -Plinux64 install

- If successful, the test will have created a file called *bar* in the volume, and written *hello world* into it.

        ls -la /var/tmp/foo
        cat /var/tmp/foo/bar

- There should also be a log file generated by libgfapi in the test program, check it out

        cat glfsjni/glfsjni-linux64/target/glfsjni.log

# Project License

As with GlusterFS generally and libgfapi in particular...

This project is licensed to you under your choice of the GNU Lesser General Public 
License, version 3 or any later version (LGPLv3 or later), or the GNU General Public 
License, version 2 (GPLv2), in all cases as published by the Free Software Foundation.
